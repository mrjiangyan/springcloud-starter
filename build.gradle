allprojects {
//    apply plugin: 'maven'
    apply plugin: 'maven-publish'
    apply plugin: 'java'
    apply plugin: 'idea'


    group = 'com.touchbiz.starter'
    version = '1.0'
    buildscript {
        ext {
            commonLang3Version = '3.10'
            aspectjVersion = 'deploy.sh.5'
            springBootVersion = '2.3.5.RELEASE'
            springVersion = '5.2.8.RELEASE'
            springCloudVersion = '2.1.2.RELEASE'
            mavenUserName = '61402da4c364e0737d2e4d14'
            mavenPassword = 'Gl9SYH4Xz'

            lombokVersion = '1.18.12'
            nacosStarterVersion = '2.1.0.RELEASE'
            swaggerVersion = '3.0.0'
            swaggerLayerVersion = '1.1.3'
            commonEntityVersion = '1.8.RELEASE'
            commonVersion = '1.7.RELEASE'
            commonPoolVersion = '1.6'
            mybatisVersion = '2.2.0'
            druidVersion = '1.2.8'
            tkVersion = '4.1.5'
            oneVersion = '1.8.6.Final'
            feignVersion = "10.10.1"
            openFeignVersion = '2.2.3.RELEASE'
            validationVersion = '2.0.1.Final'
            mysqlVerision = '8.0.25'
            revision = '2.4.RELEASE'
            jacksonVersion = '2.11.1'
            repositoryUrl = 'https://packages.aliyun.com/maven/repository/2031284-release-KDf3XN'
            //toplist 配置
//            repositoryUrl = 'https://packages.aliyun.com/maven/repository/2041383-release-F0cHwt/'

        }
        repositories {
            mavenCentral()
        }


    }


    allprojects {
        repositories {
            maven {
                url 'https://maven.aliyun.com/repository/public'
            }
            maven {
                credentials {
                    username "$mavenUserName"
                    password "$mavenPassword"
                }
                url 'https://packages.aliyun.com/maven/repository/2137731-release-WXgfEj/'
            }
            maven {
                credentials {
                    username "$mavenUserName"
                    password "$mavenPassword"
                }
                url 'https://packages.aliyun.com/maven/repository/2137731-snapshot-r3SMMA/'
            }
        }
    }

}


/**所有子项目应用Java插件*/

subprojects {
//    apply plugin: 'maven'
    apply plugin: 'maven-publish'
    apply plugin: 'java'
    apply plugin: 'idea'

    sourceCompatibility = '1.8'
    group = 'com.touchbiz.starter'
    version = "${ revision }"

    repositories {
        google()
        jcenter()
        maven { url 'https://maven.aliyun.com/nexus/content/groups/public/' }
        maven { url 'https://repo.spring.io/snapshot' }
        maven { url 'https://repo.spring.io/milestone' }
        mavenCentral()
        maven {
            credentials {
                username "$mavenUserName"
                password "$mavenPassword"
            }
            url 'https://packages.aliyun.com/maven/repository/2137731-release-WXgfEj/'
        }
    }


    configurations {
        compileOnly {
            extendsFrom annotationProcessor
        }
    }

    //打包源代码
    task sourcesJar(type: Jar, dependsOn: classes) {
        classifier = 'sources'
        from sourceSets.main.allSource
    }

    configurations.all {
        exclude group: "org.springframework.boot", module: "spring-boot-starter-tomcat"
        exclude group: "io.undertow", module: "undertow-websockets-jsr"
        exclude group: "io.springfox", module:"springfox-swagger-ui"
    }

    [compileJava, compileTestJava]*.options*.encoding = 'UTF-8'

    artifacts {
        archives sourcesJar
    }


//    publishing {
//        publications {
//            mavenJava(MavenPublication) {
//                //指定group/artifact/version信息
//                groupId "$project.group"
//                version "$project.version"
//                artifactId "$artifactId"
//                description '公共类库'
//                from components.java
//
//                // 增加 sourcesJar 任务
//                artifact sourcesJar
//            }
//        }
//        // 发布仓库
//        repositories {
//            mavenLocal()
//
//            maven {
//                // 凭证
//                credentials {
//                    username "$mavenUserName" // 仓库发布用户名
//                    password "$mavenPassword" // 仓库发布用户密码
//                }
//                // 地址
//                url 'https://packages.aliyun.com/maven/repository/2031284-release-KDf3XN/'
//            }
//        }
//    }

    dependencies {
        compileOnly group: 'org.projectlombok', name: 'lombok', version: "${ lombokVersion }"
        annotationProcessor group: 'org.projectlombok', name: 'lombok', version: "${ lombokVersion }"
    }

}
